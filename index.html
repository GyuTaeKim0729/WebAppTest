<!doctype html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>앱 설치 테스트</title>
</head>
<script type="text/javascript">

    var launchAppUrl = 'naversearchapp://'; // 앱 스키마
    var timer;	// 타이머
    var schInterval; // 인터벌
    
    var infot;
    var left_time = 6;
    
    
    
    function init() {
        var beforediv = document.getElementById("before")
        var afterdiv = document.getElementById("after")
        var faildiv = document.getElementById("fail")
        var ban = false;
        var installed = false;
        
        info = setTimeout(function () {
            location.href = launchAppUrl;
        }, 6000);

        //schInterval = setInterval(intervalSch, 500);

        timer = setTimeout(function () {
            //alert('앱이 설치되어있지 않습니다.');
            clearInterval(schInterval);
            beforediv.style.display = "none";
            faildiv.style.display = "block";
            ban = true;
        }, 8000);

        document.addEventListener("visibilitychange", function () {
            if (!installed && !ban) {
                clearTimer();
                //alert("앱이 설치 되어 있습니다.");
                installed = true;
                ban = true;
                beforediv.style.display = "none";
                afterdiv.style.display = "block";
            }
        });
        infoTimer();
    }

    function infoTimer() {
        infot = setInterval(function () {
            left_time--;
            document.getElementById("infoTime").innerHTML = left_time + "초"
            if (left_time == 0) {
                clearInterval(infot);
                document.getElementById("infoTime").innerHTML = "어플 실행"
            }
        }, 1000);

    }

    function clearTimer() {
        //clearInterval(schInterval);
        clearTimeout(timer);
    }

    function intervalSch() {
        // 매 인터벌 마다 웹뷰가 활성화 인지 체크
        if (document.webkitHidden || document.hidden) {// 웹뷰 비활성화
            clearTimer();// 앱이 설치되어있을 경우 타이머 제거
            //alert("앱이 설치 되어 있습니다.");
        } else {	// 웹뷰 활성화
            console.log("타이머 동작");
        }
    }


</script>

<body onload="init()">
    <div id="before">
        <div style="text-align: center; margin-top: 100px;">잠시후 어플이 실행됩니다.</div>
        <div style="text-align: center; margin-top: 30px;">실행 종료 후 여기로 다시 돌아오시면 QR이 발급됩니다.</div>
        <div style="text-align: center;margin-top: 100px; font-size:50px;" id="infoTime"></div>
    </div>
    <div id="after" style="text-align: center;display: none;">
        <div style="text-align: center; margin-top: 100px;">QR을 키오스크에 인식해주세요.</div>
        <img style="height: 100px; width: 100px;"
            src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/QR_code_for_mobile_English_Wikipedia.svg/1200px-QR_code_for_mobile_English_Wikipedia.svg.png"
            alt="">
    </div>
    <div id="fail" style="display: none;">
        <div style="text-align: center; margin-top: 100px;">어플 설치가 되어있지 않습니다.</div>
        <div style="text-align: center; margin-top: 30px;">설치 후 다시 시도해주세요.</div>
    </div>
</body>

</html>
